<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>更新下载中</title>
    <style>
      body {
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        margin: 16px;
        color: #1f1f1f;
      }
      h3 {
        margin-top: 0;
      }
      progress {
        width: 100%;
        height: 20px;
      }
      .info {
        margin-top: 8px;
        font-size: 12px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <h3>正在下载更新...</h3>
    <progress id="progress" value="0" max="100"></progress>
    <div id="percent">0%</div>
    <div class="info" id="info">准备开始下载...</div>
    <script>
      const { ipcRenderer } = require('electron');
      const progressBar = document.getElementById('progress');
      const percentText = document.getElementById('percent');
      const infoText = document.getElementById('info');

      ipcRenderer.on('download-progress-data', (_event, data) => {
        const percent = Math.max(0, Math.min(100, data.percent || 0));
        progressBar.value = percent;
        percentText.textContent = percent.toFixed(2) + '%';
        infoText.textContent = `速度：${formatBytes(
          data.bytesPerSecond
        )}/s    已下载：${formatBytes(data.transferred)} / ${formatBytes(data.total)}`;
      });

      ipcRenderer.on('download-progress-status', (_event, message) => {
        if (message) {
          infoText.textContent = message;
        }
      });

      function formatBytes(bytes = 0) {
        if (!bytes) return '0 B';
        const units = ['B', 'KB', 'MB', 'GB', 'TB'];
        const index = Math.floor(Math.log(bytes) / Math.log(1024));
        return (
          (bytes / Math.pow(1024, index)).toFixed(2) + ' ' + units[index]
        );
      }
    </script>
  </body>
</html>

