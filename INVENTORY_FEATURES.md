# 库存管理功能说明

## 🆕 新增功能

### 1. 界面更新
- ✅ "客户/供应商"改为"客户"
- ✅ 添加"商品名称"字段
- ✅ 新增"库存管理"菜单

### 2. 库存管理
- ✅ 自动库存更新：
  - **进货** → 增加库存
  - **回收** → 增加库存  
  - **销售** → 减少库存
  - **赠送** → 减少库存
- ✅ 库存状态监控：
  - 🟢 库存充足 (>10)
  - 🟡 库存不足 (1-10)
  - 🔴 缺货 (0)

### 3. 数据库结构
```sql
-- 商品库存表
inventory (
  id, product_name, current_stock, unit, created_at, updated_at
)

-- 库存变动记录表  
inventory_changes (
  id, product_name, transaction_id, change_type, 
  quantity_change, stock_before, stock_after, created_at
)

-- 交易记录表新增字段
transactions.product_name
```

## 📋 使用说明

### 商人端新功能

#### 1. 添加交易记录
1. 点击"添加交易"
2. 选择交易类型（进货/销售/回收/赠送）
3. 填写**商品名称**（新增字段）
4. 填写**客户名称**（原"客户/供应商"）
5. 填写数量和价格
6. 保存后**自动更新库存**

#### 2. 库存管理页面
- **库存列表**：查看所有商品库存状态
- **库存变动记录**：查看所有库存变动历史
- **库存警告**：自动提醒缺货和库存不足
- **统计信息**：商品总数、库存状态统计

#### 3. 库存规则
- **进货/回收** → 库存 **+数量**
- **销售** → 库存 **-(数量+赠送数量)**
- **赠送** → 库存 **-(数量+赠送数量)**
- **最低库存** → 0（不会变为负数）

### 员工端更新
- ✅ 交易记录显示商品名称和客户信息
- ✅ 实时同步库存变动（只读）

## 🚀 快速开始

### 1. 数据库设置
在 Supabase SQL 编辑器中运行：
```sql
-- 运行 update-database.sql 文件内容
```

### 2. 测试流程
1. **添加进货记录**：
   - 商品：商品A
   - 数量：100
   - 结果：库存增加100

2. **添加销售记录**：
   - 商品：商品A  
   - 数量：20，赠送：5
   - 结果：库存减少25

3. **查看库存管理**：
   - 库存列表显示当前库存
   - 变动记录显示操作历史

## 📊 库存状态说明

| 库存数量 | 状态 | 颜色 | 说明 |
|---------|------|------|------|
| > 10 | 库存充足 | 🟢 绿色 | 正常状态 |
| 1-10 | 库存不足 | 🟡 橙色 | 需要补货 |
| 0 | 缺货 | 🔴 红色 | 紧急补货 |

## 🔧 技术实现

### 本地存储支持
- 数据库连接失败时自动使用本地存储
- 库存数据保存在 `localInventory`
- 变动记录保存在 `localInventoryChanges`

### 实时同步
- 交易创建时自动更新库存
- 支持数据库和本地存储双模式
- 员工端实时显示最新库存状态

## 🎯 后续扩展

可以考虑添加的功能：
- [ ] 库存预警阈值设置
- [ ] 商品分类管理
- [ ] 库存盘点功能
- [ ] 库存报表导出
- [ ] 供应商管理（如需要）


